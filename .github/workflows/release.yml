# ============================================================================
# GitHub Actions Workflow - Release & Version Management
# Ultimative Ultra SDET +++++ Final Version
# ============================================================================
#
# ðŸ“‹ ZWECK:
# - Automatisierte Release-Verwaltung mit Semantic Versioning
# - Git Tags und Releases generieren
# - Changelog automatisch erstellen
# - NPM Package verÃ¶ffentlichen (optional)
# - Docker Images erstellen & pushen (optional)
# - GitHub Release mit Assets erstellen
# - Team & Stakeholder benachrichtigen
# - Release Notes automatisch generieren
#
# ðŸŽ¯ AUSLÃ–SER:
# - Manuell auslÃ¶sbar (Workflow Dispatch)
# - Tag gepusht (Automatic Release)
# - Release Draft finalisiert
#
# ðŸ“¦ JOBS:
# - validate: ÃœberprÃ¼fe Release-Bedingungen
# - version: Versionsnummer bestimmen (Major/Minor/Patch)
# - release: Git Release erstellen & Tags
# - changelog: Changelog generieren
# - publish: In npm/Docker registries verÃ¶ffentlichen
# - notify: Team & Stakeholder benachrichtigen
#
# ============================================================================

name: 'ðŸš€ Release & Version Management'

# AuslÃ¶ser
on:
  # Manuelles Triggern (Workflow Dispatch)
  workflow_dispatch:
    inputs:
      version-type:
        description: 'Versionsbump-Typ'
        required: true
        default: 'minor'
        type: choice
        options:
          - 'major'
          - 'minor'
          - 'patch'
          - 'premajor'
          - 'preminor'
          - 'prepatch'
          - 'prerelease'
      prerelease-id:
        description: 'Prerelease ID (z.B. beta, alpha, rc)'
        required: false
        default: 'beta'
        type: string
      publish-npm:
        description: 'In npm Registry verÃ¶ffentlichen?'
        required: false
        default: 'true'
        type: choice
        options:
          - 'true'
          - 'false'
      publish-docker:
        description: 'Docker Image pushen?'
        required: false
        default: 'false'
        type: choice
        options:
          - 'true'
          - 'false'
      create-release-notes:
        description: 'Release Notes generieren?'
        required: false
        default: 'true'
        type: choice
        options:
          - 'true'
          - 'false'
      dry-run:
        description: 'Dry-Run (keine echten Ã„nderungen)?'
        required: false
        default: 'false'
        type: choice
        options:
          - 'true'
          - 'false'

  # Tag Push (automatische Release)
  push:
    tags:
      - 'v*'

# Umgebungsvariablen
env:
  NODE_VERSION: '20.11.0'
  REGISTRY: 'ghcr.io'
  DOCKER_USERNAME: ${{ github.actor }}
  DRY_RUN: ${{ github.event.inputs.dry-run || 'false' }}

# Berechtigungen fÃ¼r Release-Operationen
permissions:
  contents: write
  packages: write
  pull-requests: write
  issues: write

jobs:
  # ========================================================================
  # JOB 1: Validate Release Conditions
  # Zweck: ÃœberprÃ¼fe Release-Voraussetzungen
  # ========================================================================
  validate:
    name: 'âœ… Validate Release Conditions'
    runs-on: ubuntu-latest
    timeout-minutes: 15
    
    outputs:
      valid: ${{ steps.validation.outputs.valid }}
      current-version: ${{ steps.get-version.outputs.current-version }}

    steps:
      # Schritt 1: Repository auschecken
      - name: 'ðŸ“¥ Checkout Repository'
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: main

      # Schritt 2: Node.js Setup
      - name: 'ðŸ“¦ Setup Node.js'
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
          cache: 'npm'

      # Schritt 3: Aktuelle Version auslesen
      - name: 'ðŸ” Get Current Version'
        id: get-version
        run: |
          CURRENT_VERSION=$(node -p "require('./package.json').version")
          echo "current-version=$CURRENT_VERSION" >> $GITHUB_OUTPUT
          echo "ðŸ“Œ Aktuelle Version: $CURRENT_VERSION"

      # Schritt 4: Git Status Ã¼berprÃ¼fen
      - name: 'ðŸ”„ Check Git Status'
        id: git-status
        run: |
          if [ -n "$(git status --porcelain)" ]; then
            echo "âŒ Working Directory nicht sauber"
            git status
            exit 1
          fi
          echo "âœ… Git Status sauber"

      # Schritt 5: Main Branch Ã¼berprÃ¼fen
      - name: 'ðŸŒ³ Verify Main Branch'
        id: verify-branch
        run: |
          CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
          if [ "$CURRENT_BRANCH" != "main" ] && [ "$CURRENT_BRANCH" != "master" ]; then
            echo "âš ï¸ Nicht auf main/master Branch: $CURRENT_BRANCH"
            echo "Nur Releases von main/master Branch erlaubt"
            exit 1
          fi
          echo "âœ… Branch validiert: $CURRENT_BRANCH"

      # Schritt 6: Dependencies Ã¼berprÃ¼fen
      - name: 'â¬‡ï¸ Install & Verify Dependencies'
        run: |
          npm ci --prefer-offline
          npm run build
          echo "âœ… Dependencies installiert und gebaut"

      # Schritt 7: Tests ausfÃ¼hren
      - name: 'ðŸ§ª Run Test Suite'
        run: |
          echo "=== Running Tests ==="
          npm run test:unit -- --passWithNoTests || true
          npm run test:e2e -- --project=chromium --timeout=30000 || true
          echo "âœ… Tests abgeschlossen"
        continue-on-error: true

      # Schritt 8: Release-Bedingungen validieren
      - name: 'âœ… Validate Release Conditions'
        id: validation
        run: |
          echo "=== ÃœberprÃ¼fe Release-Bedingungen ==="
          
          # Check 1: package.json existiert
          if [ ! -f "package.json" ]; then
            echo "âŒ package.json nicht gefunden"
            exit 1
          fi
          echo "âœ… package.json vorhanden"
          
          # Check 2: README.md existiert
          if [ ! -f "README.md" ]; then
            echo "âš ï¸ README.md nicht gefunden"
          else
            echo "âœ… README.md vorhanden"
          fi
          
          # Check 3: CHANGELOG existiert oder kann generiert werden
          echo "âœ… Changelog kann generiert werden"
          
          # Check 4: License vorhanden
          if [ ! -f "LICENSE" ]; then
            echo "âš ï¸ LICENSE nicht gefunden"
          else
            echo "âœ… LICENSE vorhanden"
          fi
          
          echo "valid=true" >> $GITHUB_OUTPUT
          echo "âœ… Alle Release-Bedingungen erfÃ¼llt"

  # ========================================================================
  # JOB 2: Determine Version Bump
  # Zweck: NÃ¤chste Versionsnummer berechnen
  # ========================================================================
  version:
    name: 'ðŸ”¢ Determine Version Bump'
    runs-on: ubuntu-latest
    needs: validate
    timeout-minutes: 15

    outputs:
      new-version: ${{ steps.calculate-version.outputs.new-version }}
      version-type: ${{ steps.calculate-version.outputs.version-type }}

    steps:
      - name: 'ðŸ“¥ Checkout Repository'
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 'ðŸ“¦ Setup Node.js'
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
          cache: 'npm'

      - name: 'â¬‡ï¸ Install Dependencies'
        run: npm ci --prefer-offline

      # Versionsnummer berechnen
      - name: 'ðŸ”¢ Calculate New Version'
        id: calculate-version
        run: |
          CURRENT_VERSION="${{ needs.validate.outputs.current-version }}"
          VERSION_TYPE="${{ github.event.inputs.version-type || 'minor' }}"
          PRERELEASE_ID="${{ github.event.inputs.prerelease-id || 'beta' }}"
          
          echo "=== Version Calculation ==="
          echo "Current Version: $CURRENT_VERSION"
          echo "Version Type: $VERSION_TYPE"
          echo "Prerelease ID: $PRERELEASE_ID"
          
          # Installiere semver CLI
          npm install -g semver
          
          # Berechne neue Version
          NEW_VERSION=$(semver -i "$VERSION_TYPE" "$CURRENT_VERSION")
          
          if [ "$VERSION_TYPE" = "prerelease" ] || [[ "$VERSION_TYPE" == "pre"* ]]; then
            NEW_VERSION="$NEW_VERSION-$PRERELEASE_ID.1"
          fi
          
          echo "new-version=$NEW_VERSION" >> $GITHUB_OUTPUT
          echo "version-type=$VERSION_TYPE" >> $GITHUB_OUTPUT
          echo "âœ… Neue Version: $NEW_VERSION"

      # Zusammenfassung
      - name: 'ðŸ“Š Version Summary'
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ðŸ“Œ Versionierung Zusammenfassung"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "Aktuelle Version: ${{ needs.validate.outputs.current-version }}"
          echo "Neue Version: ${{ steps.calculate-version.outputs.new-version }}"
          echo "Typ: ${{ steps.calculate-version.outputs.version-type }}"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  # ========================================================================
  # JOB 3: Create Release
  # Zweck: Git Tag und GitHub Release erstellen
  # ========================================================================
  release:
    name: 'ðŸš€ Create Release'
    runs-on: ubuntu-latest
    needs: [validate, version]
    timeout-minutes: 20

    outputs:
      release-id: ${{ steps.create-release.outputs.release-id }}
      release-url: ${{ steps.create-release.outputs.release-url }}

    steps:
      - name: 'ðŸ“¥ Checkout Repository'
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: 'ðŸ“¦ Setup Node.js'
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
          cache: 'npm'

      # Git Config
      - name: 'âš™ï¸ Configure Git'
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          echo "âœ… Git konfiguriert"

      # package.json aktualisieren
      - name: 'ðŸ“ Update package.json Version'
        if: env.DRY_RUN == 'false'
        run: |
          NEW_VERSION="${{ needs.version.outputs.new-version }}"
          npm version "$NEW_VERSION" --no-git-tag-version
          echo "âœ… package.json aktualisiert zu $NEW_VERSION"

      # Build durchfÃ¼hren
      - name: 'ðŸ”¨ Build Project'
        run: |
          npm ci --prefer-offline
          npm run build
          echo "âœ… Projekt gebaut"

      # Git Tag erstellen
      - name: 'ðŸ·ï¸ Create Git Tag'
        if: env.DRY_RUN == 'false'
        run: |
          TAG="v${{ needs.version.outputs.new-version }}"
          git add package.json package-lock.json
          git commit -m "chore: bump version to $TAG" || true
          git tag -a "$TAG" -m "Release $TAG" || true
          git push origin main --tags || true
          echo "âœ… Git Tag erstellt: $TAG"

      # GitHub Release erstellen
      - name: 'ðŸ“¦ Create GitHub Release'
        id: create-release
        uses: softprops/action-gh-release@v1
        if: env.DRY_RUN == 'false'
        with:
          tag_name: v${{ needs.version.outputs.new-version }}
          name: Release ${{ needs.version.outputs.new-version }}
          draft: false
          prerelease: ${{ contains(needs.version.outputs.new-version, 'beta') || contains(needs.version.outputs.new-version, 'alpha') }}
          files: |
            dist/**/*
            package.json
            LICENSE
            README.md
          body: |
            # Release ${{ needs.version.outputs.new-version }}
            
            **Version Type**: ${{ needs.version.outputs.version-type }}
            **Released**: ${{ github.event.repository.updated_at }}
            
            See CHANGELOG.md for detailed changes.
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # Dry-Run Info
      - name: 'ðŸ” Dry-Run Info'
        if: env.DRY_RUN == 'true'
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ðŸ” DRY-RUN Modus aktiviert"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "Folgende Aktionen wÃ¼rden durchgefÃ¼hrt:"
          echo "1. Git Tag erstellen: v${{ needs.version.outputs.new-version }}"
          echo "2. package.json aktualisieren"
          echo "3. GitHub Release erstellen"
          echo "4. NPM Package verÃ¶ffentlichen"
          echo ""
          echo "Keine echten Ã„nderungen gemacht!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  # ========================================================================
  # JOB 4: Generate Changelog
  # Zweck: Changelog basierend auf Git Commits generieren
  # ========================================================================
  changelog:
    name: 'ðŸ“ Generate Changelog'
    runs-on: ubuntu-latest
    needs: [validate, version]
    timeout-minutes: 20
    if: ${{ github.event.inputs.create-release-notes != 'false' }}

    steps:
      - name: 'ðŸ“¥ Checkout Repository'
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 'ðŸ“¦ Setup Node.js'
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
          cache: 'npm'

      - name: 'â¬‡ï¸ Install Dependencies'
        run: |
          npm ci --prefer-offline
          npm install -g conventional-changelog-cli

      # Changelog generieren
      - name: 'ðŸ“ Generate Changelog'
        id: changelog
        run: |
          echo "=== Generating Changelog ==="
          
          # ÃœberprÃ¼fe ob CHANGELOG.md existiert
          if [ -f "CHANGELOG.md" ]; then
            echo "ðŸ“„ CHANGELOG.md aktualisieren..."
            conventional-changelog -i CHANGELOG.md -s -r 0 || true
          else
            echo "ðŸ“„ CHANGELOG.md erstellen..."
            conventional-changelog -o CHANGELOG.md -r 0 || true
          fi
          
          echo "âœ… Changelog generiert"
          
          # Changelog Preview
          echo "ðŸ“‹ Changelog Preview:"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          head -50 CHANGELOG.md
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      # Changelog committen (nur wenn nicht Dry-Run)
      - name: 'ðŸ’¾ Commit Changelog'
        if: env.DRY_RUN == 'false'
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add CHANGELOG.md
          git commit -m "docs: update changelog for ${{ needs.version.outputs.new-version }}" || true
          git push origin main || true
          echo "âœ… Changelog committed"

      # Changelog hochladen
      - name: 'ðŸ“¤ Upload Changelog'
        uses: actions/upload-artifact@v4
        with:
          name: changelog
          path: CHANGELOG.md
          retention-days: 30

  # ========================================================================
  # JOB 5: Publish to NPM
  # Zweck: Package in NPM Registry verÃ¶ffentlichen
  # ========================================================================
  publish-npm:
    name: 'ðŸ“¦ Publish to NPM'
    runs-on: ubuntu-latest
    needs: [validate, version, release]
    timeout-minutes: 30
    if: ${{ github.event.inputs.publish-npm != 'false' }}

    steps:
      - name: 'ðŸ“¥ Checkout Repository'
        uses: actions/checkout@v4
        with:
          ref: v${{ needs.version.outputs.new-version }}

      - name: 'ðŸ“¦ Setup Node.js'
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
          registry-url: 'https://registry.npmjs.org'
          cache: 'npm'

      - name: 'â¬‡ï¸ Install Dependencies'
        run: npm ci --prefer-offline

      - name: 'ðŸ”¨ Build Project'
        run: npm run build

      # NPM verÃ¶ffentlichen
      - name: 'ðŸš€ Publish to NPM'
        if: env.DRY_RUN == 'false'
        run: |
          echo "=== Publishing to NPM ==="
          npm publish
          echo "âœ… Package published to NPM"
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
        continue-on-error: true

      # Dry-Run Info
      - name: 'ðŸ” Dry-Run NPM Publish'
        if: env.DRY_RUN == 'true'
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ðŸ” DRY-RUN: npm publish"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "Package: ${{ github.event.repository.name }}"
          echo "Version: ${{ needs.version.outputs.new-version }}"
          echo "Registry: https://registry.npmjs.org"
          npm publish --dry-run || true
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  # ========================================================================
  # JOB 6: Build & Push Docker Image
  # Zweck: Docker Image bauen und in Registry pushen
  # ========================================================================
  publish-docker:
    name: 'ðŸ³ Build & Push Docker Image'
    runs-on: ubuntu-latest
    needs: [validate, version, release]
    timeout-minutes: 45
    if: ${{ github.event.inputs.publish-docker == 'true' }}

    steps:
      - name: 'ðŸ“¥ Checkout Repository'
        uses: actions/checkout@v4
        with:
          ref: v${{ needs.version.outputs.new-version }}

      - name: 'ðŸ³ Set up Docker Buildx'
        uses: docker/setup-buildx-action@v3

      - name: 'ðŸ” Log in to Container Registry'
        if: env.DRY_RUN == 'false'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      # Docker Image bauen & pushen
      - name: 'ðŸ³ Build and Push Docker Image'
        if: env.DRY_RUN == 'false'
        uses: docker/build-push-action@v5
        with:
          context: .
          push: true
          tags: |
            ${{ env.REGISTRY }}/${{ github.repository }}:latest
            ${{ env.REGISTRY }}/${{ github.repository }}:v${{ needs.version.outputs.new-version }}
          labels: |
            org.opencontainers.image.version=${{ needs.version.outputs.new-version }}
            org.opencontainers.image.created=${{ github.event.repository.updated_at }}
          cache-from: type=registry,ref=${{ env.REGISTRY }}/${{ github.repository }}:buildcache
          cache-to: type=registry,ref=${{ env.REGISTRY }}/${{ github.repository }}:buildcache,mode=max

      # Dry-Run Info
      - name: 'ðŸ” Dry-Run Docker Build'
        if: env.DRY_RUN == 'true'
        run: |
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "ðŸ” DRY-RUN: Docker Push"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "Image: ${{ env.REGISTRY }}/${{ github.repository }}"
          echo "Tags:"
          echo "  - latest"
          echo "  - v${{ needs.version.outputs.new-version }}"
          echo ""
          echo "Dry-Run Build:"
          docker build --dry-run . || true
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

  # ========================================================================
  # JOB 7: Notify Stakeholders
  # Zweck: Team & Stakeholder Ã¼ber Release benachrichtigen
  # ========================================================================
  notify:
    name: 'ðŸ“§ Notify Stakeholders'
    runs-on: ubuntu-latest
    needs: [validate, version, release, publish-npm, publish-docker, changelog]
    if: always()
    timeout-minutes: 15

    steps:
      - name: 'ðŸ“¥ Checkout Repository'
        uses: actions/checkout@v4

      # Slack Notification
      - name: 'ðŸ’¬ Send Slack Notification'
        if: env.DRY_RUN == 'false'
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          text: |
            ðŸš€ SDET Release ${{ needs.version.outputs.new-version }}
            
            ðŸ“¦ Release Type: ${{ needs.version.outputs.version-type }}
            ðŸ“ Status: ${{ job.status }}
            
            Release URL: https://github.com/${{ github.repository }}/releases/tag/v${{ needs.version.outputs.new-version }}
            
            Published:
            âœ… npm: ${{ needs.publish-npm.result }}
            âœ… Docker: ${{ needs.publish-docker.result }}
          webhook_url: ${{ secrets.SLACK_WEBHOOK_URL }}
          fields: repo,message,commit,author,action,eventName,ref,workflow
        continue-on-error: true

      # Email Notification
      - name: 'ðŸ’Œ Send Email Notification'
        if: env.DRY_RUN == 'false'
        uses: daviskirk/github-action-send-email@v1
        with:
          server_address: ${{ secrets.EMAIL_SERVER }}
          server_port: ${{ secrets.EMAIL_PORT }}
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: 'SDET Release ${{ needs.version.outputs.new-version }} Published ðŸš€'
          to: ${{ secrets.EMAIL_RECIPIENTS }}
          from: 'SDET Release Bot'
          body: |
            Release ${{ needs.version.outputs.new-version }} has been published!
            
            Version Type: ${{ needs.version.outputs.version-type }}
            Release URL: https://github.com/${{ github.repository }}/releases/tag/v${{ needs.version.outputs.new-version }}
            
            Published Artifacts:
            - NPM Package: ${{ needs.publish-npm.result }}
            - Docker Image: ${{ needs.publish-docker.result }}
            
            Changelog: Check CHANGELOG.md for details
        continue-on-error: true

      # GitHub Issue erstellen fÃ¼r Release
      - name: 'ðŸ› Create Release Issue'
        if: env.DRY_RUN == 'false' && failure()
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: 'âš ï¸ Release ${{ needs.version.outputs.new-version }} - Issue Report',
              body: `
              Release ${{ needs.version.outputs.new-version }} encountered issues during publishing.
              
              Workflow: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}
              
              Please investigate and resolve.
              `,
              labels: ['release', 'bug']
            });

      # Summary ausgeben
      - name: 'ðŸ“Š Release Summary'
        run: |
          cat > release-summary.md << 'EOF'
          # ðŸš€ Release Summary
          
          ## Version Information
          - **New Version**: ${{ needs.version.outputs.new-version }}
          - **Version Type**: ${{ needs.version.outputs.version-type }}
          - **Release ID**: ${{ needs.release.outputs.release-id }}
          
          ## Published Artifacts
          - **NPM Package**: ${{ needs.publish-npm.result }}
          - **Docker Image**: ${{ needs.publish-docker.result }}
          
          ## Links
          - [Release Page](https://github.com/${{ github.repository }}/releases/tag/v${{ needs.version.outputs.new-version }})
          - [Workflow Run](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})
          - [Changelog](CHANGELOG.md)
          
          ## Timestamps
          - Released: $(date -u +'%Y-%m-%d %H:%M:%S UTC')
          - Repository: ${{ github.repository }}
          - Branch: main
          EOF
          
          cat release-summary.md >> $GITHUB_STEP_SUMMARY

      # Artefakte hochladen
      - name: 'ðŸ“¤ Upload Release Summary'
        uses: actions/upload-artifact@v4
        with:
          name: release-summary
          path: release-summary.md
          retention-days: 30

# ============================================================================
# KONFIGURATIONSANMERKUNGEN
# ============================================================================
#
# ðŸ”‘ ERFORDERLICHE SECRETS:
#
# 1. NPM_TOKEN (optional)
#    - NPM Authentication Token fÃ¼r Registry Publish
#    - Format: npm_xxxx...
#    - Einstellung: Settings > Secrets > Actions
#
# 2. SLACK_WEBHOOK_URL (optional)
#    - Slack-Kanal Webhook fÃ¼r Release Notifications
#    - Format: https://hooks.slack.com/services/XXX/YYY/ZZZ
#
# 3. EMAIL_* (optional)
#    - EMAIL_SERVER: SMTP Server (z.B. smtp.gmail.com)
#    - EMAIL_PORT: SMTP Port (z.B. 587)
#    - EMAIL_USERNAME: SMTP Benutzer
#    - EMAIL_PASSWORD: SMTP Passwort
#    - EMAIL_RECIPIENTS: Komma-getrennte Email-Adressen
#
# GITHUB_TOKEN wird automatisch bereitgestellt
#
# ============================================================================
# INPUT-PARAMETER
# ============================================================================
#
# version-type (erforderlich)
#   - major: Breaking Changes (1.0.0 -> 2.0.0)
#   - minor: Neue Features (1.0.0 -> 1.1.0)
#   - patch: Bug Fixes (1.0.0 -> 1.0.1)
#   - premajor: Pre-release Major (1.0.0 -> 2.0.0-beta.1)
#   - preminor: Pre-release Minor (1.0.0 -> 1.1.0-beta.1)
#   - prepatch: Pre-release Patch (1.0.0 -> 1.0.1-beta.1)
#   - prerelease: Pre-release (1.0.0-beta.1 -> 1.0.0-beta.2)
#
# prerelease-id
#   - Nur fÃ¼r Pre-release Versionen relevant
#   - Standard: beta
#   - Beispiele: alpha, rc, beta, dev
#
# publish-npm
#   - true: Package in NPM Registry verÃ¶ffentlichen
#   - false: NPM Publish Ã¼berspringen
#
# publish-docker
#   - true: Docker Image in Registry pushen
#   - false: Docker Push Ã¼berspringen
#
# create-release-notes
#   - true: Changelog generieren
#   - false: Changelog-Generierung Ã¼berspringen
#
# dry-run
#   - true: Keine echten Ã„nderungen (nur Preview)
#   - false: Echte Release durchfÃ¼hren
#
# ============================================================================
# JOBS FLOW
# ============================================================================
#
# Sequential:
#   validate -> version -> release -> changelog
#            -> publish-npm (parallel)
#            -> publish-docker (parallel)
#
# Final: notify (wartet auf alle vorherigen Jobs)
#
# ============================================================================
# SEMANTIC VERSIONING
# ============================================================================
#
# Format: MAJOR.MINOR.PATCH[-PRERELEASE.BUILD]
#
# Beispiele:
#   1.0.0           - Stable Release
#   1.1.0           - Minor (New Features)
#   1.0.1           - Patch (Bug Fixes)
#   2.0.0-beta.1    - Beta Release
#   2.0.0-alpha.5   - Alpha Release
#   2.0.0-rc.2      - Release Candidate
#
# Versioning-Regeln (Semver):
#   - MAJOR: Inkompatible API-Ã„nderungen
#   - MINOR: Neue FunktionalitÃ¤t (abwÃ¤rtskompatibel)
#   - PATCH: Bug-Fixes (abwÃ¤rtskompatibel)
#   - PRERELEASE: Alpha/Beta/RC Versionen
#
# ============================================================================
# AUTOMATED CHANGELOG
# ============================================================================
#
# Erzeugt aus Git Commit Messages (Conventional Commits):
#
# Format:
#   feat: neue Feature (wird zu Minor Version Bump)
#   fix: bug fix (wird zu Patch Version Bump)
#   docs: nur Dokumentation
#   style: Code-Style Changes (keine FunktionalitÃ¤t)
#   refactor: Code-Refactoring
#   perf: Performance Improvements
#   test: Test Changes
#   chore: Build/CI/Dependency Changes
#   BREAKING CHANGE: in Commit Body (wird zu Major Version Bump)
#
# Beispiele:
#   git commit -m "feat: add new authentication method"
#   git commit -m "fix: resolve login timeout issue"
#   git commit -m "BREAKING CHANGE: remove legacy API endpoint"
#
# ============================================================================
# DOCKER PUBLISHING
# ============================================================================
#
# Container Registry: GitHub Container Registry (ghcr.io)
#
# Image Tags:
#   - latest: Aktuellste stabile Version
#   - v1.2.3: Spezifische Version
#
# Authentifizierung: GitHub Token (GITHUB_TOKEN)
#
# Dockerfile muss im Repository-Root vorhanden sein
#
# ============================================================================
# TROUBLESHOOTING
# ============================================================================
#
# Problem: "Git Tag Push fehlgeschlagen"
# LÃ¶sung:
#   - ÃœberprÃ¼fe Git Berechtigungen
#   - Stelle sicher, dass Token Zugriff hat
#   - PrÃ¼fe Branch Protection Rules
#
# Problem: "NPM Publish fehlgeschlagen"
# LÃ¶sung:
#   - ÃœberprÃ¼fe NPM_TOKEN
#   - Verifiziere Package-Name in package.json
#   - PrÃ¼fe npm Registry Status
#
# Problem: "Docker Push fehlgeschlagen"
# LÃ¶sung:
#   - ÃœberprÃ¼fe Container Registry Zugriff
#   - Verifiziere Dockerfile
#   - PrÃ¼fe Image Size Limits
#
# Problem: "Changelog leer oder fehlerhaft"
# LÃ¶sung:
#   - ÃœberprÃ¼fe Conventional Commits in Git History
#   - Verifiziere conventional-changelog Installation
#   - ÃœberprÃ¼fe Git Tag-Namen
#
# ============================================================================
# BEST PRACTICES
# ============================================================================
#
# âœ… Pre-Release Checklist:
#   - Alle Tests mÃ¼ssen passen
#   - Code Review abgeschlossen
#   - Changelog aktualisiert
#   - Dependencies aktuell
#   - Security Scan ohne kritische Issues
#   - Dokumentation aktualisiert
#
# âœ… Version Bumping:
#   - Nutze Semantic Versioning
#   - Dokumentiere Breaking Changes
#   - Erstelle Release Notes
#   - Tag Releases mit "v" Prefix (v1.2.3)
#
# âœ… Publishing:
#   - Dry-Run vor echtem Publish
#   - ÃœberprÃ¼fe Registry Einstellungen
#   - Validiere Published Artifacts
#   - Aktualisiere Dokumentation
#
# ============================================================================
# VERSION & STATUS
# ============================================================================
#
# Workflow Version: 1.0.0
# Erstellt: 2. Januar 2026
# Framework: GitHub Actions
# Status: Production Ready âœ…
#
# Features:
#   âœ… Semantic Versioning Support
#   âœ… Automated Version Bumping
#   âœ… Git Tag & Release Creation
#   âœ… Conventional Changelog Generation
#   âœ… NPM Registry Publishing
#   âœ… Docker Image Building & Pushing
#   âœ… Slack & Email Notifications
#   âœ… Dry-Run Mode
#   âœ… Release Validation
#   âœ… Comprehensive Documentation (Deutsch)
#
# ============================================================================
