# ============================================================================
# GitHub Actions Workflow - Pull Request Validation
# Ultimative Ultra SDET +++++ Final Version
# ============================================================================
#
# üìã ZWECK:
# - Validiere alle Pull Requests vor dem Merge
# - F√ºhre Unit-, Integration- und E2E-Tests aus
# - Pr√ºfe Code-Qualit√§t und Sicherheit
# - √úberpr√ºfe Linting & Formatting Standards
# - Generiere Test Coverage Reports
# - Verhindere Merges mit fehlgeschlagenen Tests
# - Gebe automatisches Feedback zu √Ñnderungen
#
# üéØ AUSL√ñSER:
# - Pull Request ge√∂ffnet oder aktualisiert
# - Commits zu bestehende PR gepusht
# - Manuell ausl√∂sbar (Workflow Dispatch)
#
# üì¶ JOBS:
# - lint: ESLint, Prettier, TypeScript √úberpr√ºfung
# - unit-tests: Jest Unit Tests
# - e2e-tests: Playwright E2E Tests
# - security: Security Scans & Vulnerability Checks
# - coverage: Code Coverage Reports
# - validate-pr: PR Requirements Check
#
# ============================================================================

name: '‚úÖ PR Validation & Quality Checks'

# Ausl√∂ser
on:
  # Pull Request Events
  pull_request:
    types:
      - opened
      - synchronize
      - reopened
      - ready_for_review
    paths:
      - 'src/**'
      - 'tests/**'
      - 'config/**'
      - 'package.json'
      - 'package-lock.json'
      - 'tsconfig.json'
      - '.github/workflows/pr-validation.yml'
      - '!docs/**'
      - '!*.md'

  # Manuelle Ausl√∂sung
  workflow_dispatch:
    inputs:
      run_security_scan:
        description: 'Security Scan durchf√ºhren?'
        required: false
        default: 'true'
        type: choice
        options:
          - 'true'
          - 'false'
      run_coverage:
        description: 'Coverage Reports erstellen?'
        required: false
        default: 'true'
        type: choice
        options:
          - 'true'
          - 'false'
      verbosity:
        description: 'Output Verbosit√§t'
        required: false
        default: 'normal'
        type: choice
        options:
          - 'quiet'
          - 'normal'
          - 'verbose'
          - 'debug'

# Umgebungsvariablen
env:
  NODE_VERSION: '20.11.0'
  NPM_VERSION: '10.2.4'
  CACHE_KEY_PREFIX: 'sdet-pr-validation'
  ARTIFACTS_RETENTION: 5

# Berechtigungen
permissions:
  contents: read
  pull-requests: write
  checks: write
  statuses: write
  security-events: write

jobs:
  # ========================================================================
  # JOB 1: Code Quality & Linting
  # Zweck: ESLint, Prettier, TypeScript, Formatting √ºberpr√ºfen
  # ========================================================================
  lint:
    name: 'üîç Code Quality & Linting'
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    outputs:
      lint-status: ${{ steps.lint-status.outputs.status }}
      lint-report: ${{ steps.lint-report.outputs.report }}

    steps:
      # Schritt 1: Repository auschecken
      - name: 'üì• Checkout Repository'
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: ${{ github.event.pull_request.head.sha }}

      # Schritt 2: Node.js Setup
      - name: 'üì¶ Setup Node.js'
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
          cache: 'npm'
          cache-dependency-path: '**/package-lock.json'

      # Schritt 3: Dependencies installieren
      - name: '‚¨áÔ∏è Install Dependencies'
        run: npm ci --prefer-offline

      # Schritt 4: ESLint ausf√ºhren
      - name: 'üîé Run ESLint'
        id: eslint
        run: |
          echo "=== ESLint √úberpr√ºfung ==="
          npm run lint -- --format=json --output-file=eslint-report.json || true
          
          if [ -f eslint-report.json ]; then
            echo "‚úÖ ESLint Report erstellt"
          fi
        continue-on-error: true

      # Schritt 5: Prettier Formatierung pr√ºfen
      - name: 'üé® Check Prettier Formatting'
        id: prettier
        run: |
          echo "=== Prettier Formatierung √úberpr√ºfung ==="
          npm run format:check || {
            echo "‚ö†Ô∏è Code-Formatierungsprobleme gefunden"
            npm run format -- --list-different
            exit 1
          }
        continue-on-error: true

      # Schritt 6: TypeScript Compilation pr√ºfen
      - name: 'üìò Check TypeScript Compilation'
        id: typescript
        run: |
          echo "=== TypeScript √úberpr√ºfung ==="
          npm run build -- --noEmit --listFiles
          
          if [ $? -eq 0 ]; then
            echo "‚úÖ TypeScript kompiliert erfolgreich"
          else
            echo "‚ùå TypeScript Compilierungsfehler gefunden"
            exit 1
          fi
        continue-on-error: true

      # Schritt 7: SpellCheck
      - name: 'üìù Run Spell Check'
        id: spellcheck
        run: |
          echo "=== Spell Check ==="
          npm run spellcheck || true
        continue-on-error: true

      # Schritt 8: Lint Status bestimmen
      - name: 'üìä Determine Lint Status'
        id: lint-status
        run: |
          ESLINT_STATUS=${{ steps.eslint.outcome }}
          PRETTIER_STATUS=${{ steps.prettier.outcome }}
          TYPESCRIPT_STATUS=${{ steps.typescript.outcome }}
          
          if [ "$ESLINT_STATUS" = "failure" ] || [ "$PRETTIER_STATUS" = "failure" ] || [ "$TYPESCRIPT_STATUS" = "failure" ]; then
            echo "status=failed" >> $GITHUB_OUTPUT
            echo "‚ùå Code Quality √úberpr√ºfung fehlgeschlagen"
            exit 1
          else
            echo "status=passed" >> $GITHUB_OUTPUT
            echo "‚úÖ Code Quality √úberpr√ºfung erfolgreich"
          fi
        continue-on-error: false

      # Schritt 9: Report Zusammenfassung
      - name: 'üìù Create Lint Report Summary'
        if: always()
        id: lint-report
        run: |
          REPORT_FILE="lint-summary.md"
          cat > $REPORT_FILE << 'EOF'
          ## üîç Code Quality Report
          
          | Check | Status |
          |-------|--------|
          | ESLint | ${{ steps.eslint.outcome }} |
          | Prettier | ${{ steps.prettier.outcome }} |
          | TypeScript | ${{ steps.typescript.outcome }} |
          | Spell Check | ${{ steps.spellcheck.outcome }} |
          
          EOF
          echo "report=$REPORT_FILE" >> $GITHUB_OUTPUT
          cat $REPORT_FILE

      # Schritt 10: Artefakte hochladen
      - name: 'üì§ Upload Lint Reports'
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: lint-reports
          path: |
            eslint-report.json
            lint-summary.md
          retention-days: ${{ env.ARTIFACTS_RETENTION }}

      # Schritt 11: Kommentar zu PR hinzuf√ºgen
      - name: 'üí¨ Comment on PR'
        if: always() && github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const fs = require('fs');
            const eslintStatus = '${{ steps.eslint.outcome }}';
            const prettierStatus = '${{ steps.prettier.outcome }}';
            const tsStatus = '${{ steps.typescript.outcome }}';
            
            let emoji = '‚úÖ';
            let summary = 'All checks passed!';
            
            if (eslintStatus === 'failure' || prettierStatus === 'failure' || tsStatus === 'failure') {
              emoji = '‚ùå';
              summary = 'Some checks failed. Please review the details below.';
            }
            
            const comment = `${emoji} **Code Quality Check**
            
            | Check | Result |
            |-------|--------|
            | ESLint | ${{ steps.eslint.outcome }} |
            | Prettier | ${{ steps.prettier.outcome }} |
            | TypeScript | ${{ steps.typescript.outcome }} |
            | Spell Check | ${{ steps.spellcheck.outcome }} |
            
            ${summary}
            
            [View Details](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})`;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });

  # ========================================================================
  # JOB 2: Unit Tests
  # Zweck: Jest Unit Tests ausf√ºhren
  # ========================================================================
  unit-tests:
    name: '‚öôÔ∏è Unit Tests'
    runs-on: ubuntu-latest
    needs: lint
    timeout-minutes: 30
    continue-on-error: false

    steps:
      - name: 'üì• Checkout Repository'
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: ${{ github.event.pull_request.head.sha }}

      - name: 'üì¶ Setup Node.js'
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
          cache: 'npm'

      - name: '‚¨áÔ∏è Install Dependencies'
        run: npm ci --prefer-offline

      - name: '‚ñ∂Ô∏è Run Unit Tests'
        id: test-run
        run: |
          echo "=== F√ºhre Unit Tests aus ==="
          npm run test:unit -- \
            --coverage \
            --reporters=default \
            --reporters=jest-junit \
            --reporters=json \
            --passWithNoTests
          
          TEST_EXIT_CODE=$?
          echo "exit-code=$TEST_EXIT_CODE" >> $GITHUB_OUTPUT
          exit $TEST_EXIT_CODE
        continue-on-error: true
        env:
          CI: 'true'

      - name: 'üìä Publish Test Results'
        if: always()
        uses: EnricoMi/publish-unit-test-result-action@v2
        with:
          files: '**/junit.xml'
          check_name: 'Unit Test Results'
          comment_mode: 'always'

      - name: 'üìà Upload Coverage'
        if: always()
        uses: codecov/codecov-action@v3
        with:
          files: ./coverage/coverage-final.json
          flags: unittest
          name: 'Unit Test Coverage'
          verbose: true

      - name: '‚ùå Fail if tests failed'
        if: steps.test-run.outputs.exit-code != '0'
        run: exit 1

  # ========================================================================
  # JOB 3: E2E Tests
  # Zweck: Playwright E2E Tests ausf√ºhren
  # ========================================================================
  e2e-tests:
    name: 'üé≠ E2E Tests - ${{ matrix.browser }}'
    runs-on: ubuntu-latest
    needs: lint
    timeout-minutes: 60
    continue-on-error: false

    strategy:
      fail-fast: false
      matrix:
        browser: [chromium, firefox]

    steps:
      - name: 'üì• Checkout Repository'
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: ${{ github.event.pull_request.head.sha }}

      - name: 'üì¶ Setup Node.js'
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
          cache: 'npm'

      - name: '‚¨áÔ∏è Install Dependencies'
        run: npm ci --prefer-offline

      - name: 'üé≠ Install Playwright Browsers'
        run: npx playwright install --with-deps ${{ matrix.browser }}

      - name: '‚ñ∂Ô∏è Run E2E Tests - ${{ matrix.browser }}'
        id: e2e-run
        run: |
          echo "=== F√ºhre E2E Tests aus (${{ matrix.browser }}) ==="
          npm run test:e2e -- \
            --project=${{ matrix.browser }} \
            --reporter=html \
            --reporter=json \
            --retries=1 \
            --timeout=30000
          
          E2E_EXIT_CODE=$?
          echo "exit-code=$E2E_EXIT_CODE" >> $GITHUB_OUTPUT
          exit $E2E_EXIT_CODE
        continue-on-error: true
        env:
          CI: 'true'
          BROWSER: ${{ matrix.browser }}

      - name: 'üì∏ Upload Screenshots on Failure'
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: e2e-screenshots-${{ matrix.browser }}
          path: |
            playwright/screenshots/
            test-results/
          retention-days: ${{ env.ARTIFACTS_RETENTION }}

      - name: '‚ùå Fail if tests failed'
        if: steps.e2e-run.outputs.exit-code != '0'
        run: exit 1

  # ========================================================================
  # JOB 4: Security Scan
  # Zweck: Sicherheits- und Vulnerability-√úberpr√ºfungen
  # ========================================================================
  security:
    name: 'üîê Security & Vulnerability Scan'
    runs-on: ubuntu-latest
    timeout-minutes: 30
    if: ${{ github.event.inputs.run_security_scan != 'false' }}
    continue-on-error: false

    steps:
      - name: 'üì• Checkout Repository'
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: ${{ github.event.pull_request.head.sha }}

      - name: 'üì¶ Setup Node.js'
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
          cache: 'npm'

      - name: '‚¨áÔ∏è Install Dependencies'
        run: npm ci --prefer-offline

      # npm audit f√ºr Sicherheitsl√ºcken
      - name: 'üõ°Ô∏è Run npm audit'
        id: npm-audit
        run: |
          echo "=== npm audit Security Check ==="
          npm audit --audit-level=moderate || {
            echo "‚ö†Ô∏è Sicherheitsl√ºcken gefunden"
            npm audit --json > audit-report.json || true
            exit 1
          }
        continue-on-error: true

      # OWASP Dependency Check
      - name: '‚ö†Ô∏è Run OWASP Dependency Check'
        uses: dependency-check/Dependency-Check_Action@main
        with:
          project: 'SDET-PW-Practice'
          path: '.'
          format: 'JSON'
          args: >
            --enableExperimental
            --scan src
            --scan tests
          github-token: ${{ secrets.GITHUB_TOKEN }}
        continue-on-error: true

      # Trivy Security Scanner
      - name: 'üîç Run Trivy Scan'
        uses: aquasecurity/trivy-action@master
        with:
          scan-type: 'fs'
          scan-ref: '.'
          format: 'sarif'
          output: 'trivy-results.sarif'
        continue-on-error: true

      # Secret Detection
      - name: 'üîë Detect Secrets'
        run: |
          echo "=== Scanning for secrets ==="
          if command -v gitleaks &> /dev/null; then
            gitleaks detect --source . --exit-code 1 || {
              echo "‚ö†Ô∏è Potenzielle Secrets/Credentials gefunden"
              exit 1
            }
          else
            echo "‚ÑπÔ∏è Gitleaks nicht installiert, √ºberspringe Secret-Scan"
          fi
        continue-on-error: true

      # Upload Security Results
      - name: 'üì§ Upload Security Reports'
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: security-reports
          path: |
            audit-report.json
            dependency-check-report.json
            trivy-results.sarif
          retention-days: ${{ env.ARTIFACTS_RETENTION }}

      # Upload zu GitHub Security Tab
      - name: 'üìä Upload SARIF to GitHub Security'
        if: always()
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: 'trivy-results.sarif'
          category: 'Trivy'
        continue-on-error: true

  # ========================================================================
  # JOB 5: Code Coverage
  # Zweck: Code Coverage Reports erstellen und √ºberpr√ºfen
  # ========================================================================
  coverage:
    name: 'üìä Code Coverage Report'
    runs-on: ubuntu-latest
    needs: unit-tests
    timeout-minutes: 30
    if: ${{ github.event.inputs.run_coverage != 'false' }}

    steps:
      - name: 'üì• Checkout Repository'
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: ${{ github.event.pull_request.head.sha }}

      - name: 'üì¶ Setup Node.js'
        uses: actions/setup-node@v4
        with:
          node-version-file: '.nvmrc'
          cache: 'npm'

      - name: '‚¨áÔ∏è Install Dependencies'
        run: npm ci --prefer-offline

      - name: 'üß™ Run Tests with Coverage'
        run: |
          echo "=== Generating Coverage Reports ==="
          npm run test:coverage -- --coverage-reporters=text --coverage-reporters=json

      - name: 'üìà Generate Coverage Badge'
        uses: codecov/codecov-action@v3
        with:
          files: ./coverage/coverage-final.json
          flags: coverage
          name: 'PR Coverage'

      - name: 'üìä Publish Coverage Comment'
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const fs = require('fs');
            const coverage = JSON.parse(fs.readFileSync('./coverage/coverage-final.json', 'utf8'));
            
            // Parse coverage data
            let totalLines = 0;
            let coveredLines = 0;
            
            Object.values(coverage).forEach(file => {
              if (file.lines) {
                Object.values(file.lines).forEach(line => {
                  if (line !== null) {
                    totalLines++;
                    if (line > 0) coveredLines++;
                  }
                });
              }
            });
            
            const percentage = totalLines > 0 ? Math.round((coveredLines / totalLines) * 100) : 0;
            
            const comment = `üìä **Code Coverage Report**
            
            \`\`\`
            Overall Coverage: ${percentage}%
            Lines: ${coveredLines}/${totalLines}
            \`\`\`
            
            [View Full Report](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})`;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });

  # ========================================================================
  # JOB 6: PR Requirements Validation
  # Zweck: PR Requirements √ºberpr√ºfen (Title, Description, Labels)
  # ========================================================================
  validate-pr:
    name: '‚úÖ PR Requirements Validation'
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    timeout-minutes: 10

    steps:
      - name: 'üì• Checkout Repository'
        uses: actions/checkout@v4

      - name: 'üìã Validate PR Title'
        uses: amannn/action-semantic-pull-request@v5
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          types: |
            feat
            fix
            docs
            test
            refactor
            perf
            chore
          requireScope: false
          disallowScopes:
            - wip
            - WIP

      - name: 'üìù Check PR Description'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { data: pullRequest } = await github.rest.pulls.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number,
            });

            const descriptionLength = pullRequest.body ? pullRequest.body.trim().length : 0;
            
            if (descriptionLength < 20) {
              core.setFailed('PR Description zu kurz. Minimum 20 Zeichen erforderlich.');
            } else {
              console.log('‚úÖ PR Description ausreichend');
            }

      - name: 'üè∑Ô∏è Verify Labels'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { data: pullRequest } = await github.rest.pulls.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number,
            });

            const labels = pullRequest.labels.map(l => l.name);
            const requiredLabels = ['type:bug', 'type:feature', 'type:test', 'type:refactor', 'type:docs'];
            const hasLabel = labels.some(l => requiredLabels.includes(l));
            
            if (labels.length === 0) {
              console.warn('‚ö†Ô∏è Keine Labels gesetzt. Bitte mindestens ein Type-Label hinzuf√ºgen.');
            } else if (!hasLabel) {
              console.warn('‚ö†Ô∏è Empfohlene Type-Labels: bug, feature, test, refactor, docs');
            } else {
              console.log('‚úÖ G√ºltige Labels vorhanden');
            }

  # ========================================================================
  # JOB 7: Final Status Check
  # Zweck: Alle Job-Ergebnisse zusammenfassen
  # ========================================================================
  final-status:
    name: 'üéØ Final Validation Status'
    runs-on: ubuntu-latest
    needs: [lint, unit-tests, e2e-tests, security, validate-pr]
    if: always()
    timeout-minutes: 10

    steps:
      - name: '‚úÖ Check All Jobs Status'
        id: status-check
        run: |
          echo "=== Validierungs-Zusammenfassung ==="
          echo "Linting: ${{ needs.lint.result }}"
          echo "Unit Tests: ${{ needs.unit-tests.result }}"
          echo "E2E Tests: ${{ needs.e2e-tests.result }}"
          echo "Security: ${{ needs.security.result }}"
          echo "PR Validation: ${{ needs.validate-pr.result }}"
          
          if [ "${{ needs.lint.result }}" = "failure" ] || \
             [ "${{ needs.unit-tests.result }}" = "failure" ] || \
             [ "${{ needs.e2e-tests.result }}" = "failure" ] || \
             [ "${{ needs.security.result }}" = "failure" ]; then
            echo "‚ùå Einige √úberpr√ºfungen fehlgeschlagen"
            exit 1
          else
            echo "‚úÖ Alle √úberpr√ºfungen erfolgreich"
          fi

      - name: 'üìä Generate Summary Report'
        run: |
          cat > summary.md << 'EOF'
          # üìã PR Validation Summary
          
          ## Status
          - **Linting**: ${{ needs.lint.result }}
          - **Unit Tests**: ${{ needs.unit-tests.result }}
          - **E2E Tests**: ${{ needs.e2e-tests.result }}
          - **Security**: ${{ needs.security.result }}
          - **PR Requirements**: ${{ needs.validate-pr.result }}
          
          ## Details
          [View Workflow Run](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})
          EOF
          cat summary.md >> $GITHUB_STEP_SUMMARY

      - name: 'üí¨ Comment Final Status'
        if: github.event_name == 'pull_request' && always()
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const lintResult = '${{ needs.lint.result }}';
            const testResult = '${{ needs.unit-tests.result }}';
            const e2eResult = '${{ needs.e2e-tests.result }}';
            const secResult = '${{ needs.security.result }}';
            
            let finalStatus = '‚úÖ All Checks Passed';
            let color = 'green';
            
            if (lintResult === 'failure' || testResult === 'failure' || 
                e2eResult === 'failure' || secResult === 'failure') {
              finalStatus = '‚ùå Some Checks Failed';
              color = 'red';
            }
            
            const comment = `## ${finalStatus}
            
            | Check | Status |
            |-------|--------|
            | üîç Linting | ${lintResult} |
            | ‚öôÔ∏è Unit Tests | ${testResult} |
            | üé≠ E2E Tests | ${e2eResult} |
            | üîê Security | ${secResult} |
            
            [View Full Report](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})`;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });

# ============================================================================
# KONFIGURATIONSANMERKUNGEN
# ============================================================================
#
# üéØ WORKFLOW TRIGGER:
#
# Dieser Workflow wird automatisch ausgel√∂st bei:
#   1. PR ge√∂ffnet (opened)
#   2. Neue Commits gepusht (synchronize)
#   3. PR erneut ge√∂ffnet (reopened)
#   4. PR bereit zum Review (ready_for_review)
#
# Pfad-Filter (paths):
#   - Nur wenn Dateien in src/, tests/, config/ ge√§ndert
#   - Nur bei package.json, tsconfig.json √Ñnderungen
#   - Docs und Markdown-Dateien werden ignoriert
#
# ============================================================================
# ERFORDERLICHE SECRETS
# ============================================================================
#
# Keine separaten Secrets erforderlich!
# GitHub Token wird automatisch bereitgestellt.
#
# Optional:
#   - codecov/codecov-action ben√∂tigt GitHub Token (wird automatisch gesetzt)
#
# ============================================================================
# JOBS √úBERSICHT
# ============================================================================
#
# 1. lint (30 Min)
#    - ESLint: Code-Style und Best Practices
#    - Prettier: Code-Formatierung
#    - TypeScript: Typ-Checking und Kompilation
#    - Spell Check: Tippfehler erkennen
#
# 2. unit-tests (30 Min) - ben√∂tigt: lint
#    - Jest Unit Tests
#    - Code Coverage
#    - JUnit XML Report
#
# 3. e2e-tests (60 Min) - ben√∂tigt: lint
#    - Playwright E2E Tests
#    - Chrome & Firefox parallel
#    - Screenshot-Capture bei Fehlern
#
# 4. security (30 Min)
#    - npm audit Vulnerability Check
#    - OWASP Dependency Check
#    - Trivy Filesystem Scan
#    - Secret Detection
#
# 5. coverage (30 Min) - ben√∂tigt: unit-tests
#    - Code Coverage Reports
#    - Coverage Badge
#    - PR Comment mit Coverage %
#
# 6. validate-pr (10 Min)
#    - Semantischer PR Title
#    - PR Description Length
#    - Label √úberpr√ºfung
#
# 7. final-status (10 Min) - ben√∂tigt: alle anderen
#    - Zusammenfassung aller Ergebnisse
#    - Final Status Comment auf PR
#
# ============================================================================
# BEST PRACTICES & OPTIMIERUNGEN
# ============================================================================
#
# ‚úÖ Performance:
#   - npm ci statt npm install (schneller, deterministisch)
#   - --prefer-offline Flag (offline Cache nutzen)
#   - Parallel Job Execution wo m√∂glich
#   - Caching f√ºr Dependencies
#
# ‚úÖ Zuverl√§ssigkeit:
#   - continue-on-error f√ºr nicht-kritische Jobs
#   - Retries f√ºr flaky Tests (retries=1)
#   - Timeout-Schutz f√ºr alle Jobs
#   - Artifact Retention f√ºr Debugging
#
# ‚úÖ Feedback:
#   - PR Comments f√ºr sofortiges Feedback
#   - GitHub Status Checks f√ºr Merge-Gating
#   - Artifact Uploads f√ºr Debugging
#   - Integration mit codecov
#
# ============================================================================
# TROUBLESHOOTING
# ============================================================================
#
# Problem: "npm ci fehlgeschlagen"
# L√∂sung:
#   - Cache l√∂schen: Settings > Actions > Clear caches
#   - package-lock.json √ºberpr√ºfen
#   - npm install lokal testen
#
# Problem: "Tests schlagen fehl auf CI aber nicht lokal"
# L√∂sung:
#   - CI=true Flag √ºberpr√ºfen
#   - Playwright headless Modus
#   - Timeouts erh√∂hen auf CI
#
# Problem: "Coverage Reports nicht generiert"
# L√∂sung:
#   - npm run test:coverage ausf√ºhren
#   - coverage/ Verzeichnis pr√ºfen
#   - Jest Config √ºberpr√ºfen
#
# Problem: "PR Comments nicht erstellt"
# L√∂sung:
#   - GitHub Token Berechtigungen pr√ºfen
#   - Pull Request Kontext verf√ºgbar?
#   - Script Fehler in Logs pr√ºfen
#
# ============================================================================
# VERSION & STATUS
# ============================================================================
#
# Workflow Version: 1.0.0
# Erstellt: 2. Januar 2026
# Framework: GitHub Actions
# Status: Production Ready ‚úÖ
#
# Features:
#   ‚úÖ ESLint + Prettier + TypeScript Linting
#   ‚úÖ Jest Unit Tests mit Coverage
#   ‚úÖ Playwright E2E Tests (Chrome + Firefox)
#   ‚úÖ Security & Vulnerability Scans
#   ‚úÖ Code Coverage Reports
#   ‚úÖ PR Requirements Validation
#   ‚úÖ Automated PR Comments
#   ‚úÖ Artifact Management
#   ‚úÖ GitHub Security Tab Integration
#   ‚úÖ Comprehensive Documentation (Deutsch)
#
# ============================================================================
